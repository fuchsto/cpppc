
CC=g++
CFLAGS=--std=c++11 -Wall -Wextra -pedantic
LDFLAGS=-lrt

OBJS  = heap.o main.o
DOBJS = heap.g.o main.g.o

.DEFAULT: all
all: $(OBJS) main.a

run: main.a
	clear
	./main.a

%.o: %.cc
	$(CC) $(CFLAGS) -c $< -o $@

# Produces assembly generated by gcc:
#   (-fverbose-asm makes output clearer to read but formating
#    differs from 'real' assembly used in actual compilation)
%.s: %.cc
	$(CC) $(CFLAGS) -fverbose-asm -S $<

# Compile objects with debug symbols:
%.g.o: %.cc
	$(CC) $(CFLAGS) -g -c $< -o $@

%.a: $(OBJS)
	$(CC) $(LDFLAGS) $(OBJS) -o $@

# Produces ASM-annotated C/C++ code:
#   (also try -M intel, or use -l if you want source locations
#    inlined)
%.asm: %.g.o
	objdump -d -Mintel -S $< > $@

.PHONY: clean
clean:
	-rm -f *.o
	-rm -f *.g.o
	-rm -f *.a
	-rm -f *.s
	-rm -f *.asm

# Wow, you read the Makefile to the end!
# As a treat, feast your eyes upon this:
# http://gcc.godbolt.org/

